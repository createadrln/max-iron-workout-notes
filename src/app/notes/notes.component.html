<!-- ToDo make sure everything works or there is a fallback when not connected to firebase -->
<!-- ToDo add Alexa integration -->
<!-- ToDo Fix Spinner -->
<!-- ToDo Add Timer -->
<!-- ToDo Add Buy Me A Coffee -->

<ngx-spinner></ngx-spinner>

<header class="current-workouts__header workout-page-header">
    <div class="mx-3 mx-sm-5 my-4 my-sm-0 mt-sm-5 mb-sm-3 pb-3 border-bottom border-dark clearfix">
        <div class="float-sm-left">
            <h1 class="h5">Current Plan:</h1>
            <h2 class="h4">
                <span class="mr-1">{{ upcomingWeekTitle }}</span><br>
                <em *ngFor="let tag of upcomingWeekTags" class="mr-2">{{ tag.display }}</em>
            </h2>
        </div>
        <div class="btn btn-link text-success float-sm-right mt-2 mt-sm-0 p-0"
             (click)="openLargeModal(new_workout_modal)">
            <mat-icon class="align-middle mr-1">description</mat-icon>
            <span class="align-middle">Add New Notebook</span>
        </div>
    </div>
</header>

<!-- Workout Collections and Notes -->
<div>
    <div class="current-workouts__list px-3 px-sm-5 mb-1 mb-sm-3"
         *ngFor="let note of weeklyWorkouts | async | reverse; let n = index">
        <section>
            <div class="bg-dark text-white p-3">
                <header>
                    <div class="current-workouts__row row" (click)="hideWorkoutRows[note.key] = !hideWorkoutRows[note.key]">
                        <div class="col-9 col-md-7">
                            <div class="d-inline-block align-top">
                                <h3 class="h5 mb-0">{{ note.title }}</h3>
                                <p class="my-0 text-medium-gray">{{ note.description }}</p>
                            </div>
                        </div>
                        <div class="current-workouts__row-options col-3 col-md-5 text-right">
                            <div [hidden]="hideWorkoutRows[note.key]" class="align-top">
                                <mat-icon class="current-workouts-list-icon icon-arrow-drop-down text-white show-hover">
                                    arrow_drop_down_circle
                                </mat-icon>
                            </div>
                            <div [hidden]="!hideWorkoutRows[note.key]" class="align-top">
                                <mat-icon class="current-workouts-list-icon icon-cancel show-hover">
                                    cancel
                                </mat-icon>
                            </div>
                        </div>
                    </div>
                </header>
            </div>
        </section>

        <section>
            <div class="d-block w-100 bg-white">
                <div *ngIf="hasCurrentWorkout">
                    <div [hidden]="!hideWorkoutRows[note.key]">
                        <div *ngFor="let exercise of note.exercises; let i=index" class="border-bottom p-3">
                            <div class="row">
                                <div class="align-middle col-12">
                                    <mat-icon [hidden]="hideWorkoutRowInputs[[note.key,i]]"
                                              class="edit-workout-row-icon float-right p-0 text-secondary"
                                              (click)="hideWorkoutRowInputs[[note.key,i]] = !hideWorkoutRowInputs[[note.key,i]]">
                                        edit
                                    </mat-icon>
                                    <mat-icon [hidden]="!hideWorkoutRowInputs[[note.key,i]]"
                                              class="save-workout-row-icon float-right p-0 text-success"
                                              (click)="saveWorkoutNoteRowUpdate(
                                  note.key,
                                  i,
                                  exercise.title,
                                  exercise.sets,
                                  exercise.reps,
                                  exercise.weight,
                                  editRowSets.value,
                                  editRowReps.value,
                                  editRowWeight.value
                                  )">save
                                    </mat-icon>
                                    Exercise {{ i + 1 }}: <span class="text-primary font-weight-bold">{{ exercise.title }}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="align-middle col-4">
                                    <div class="border-bottom mt-1 mb-2 pb-1">Sets</div>
                                    <input [hidden]="hideWorkoutRowInputs[[note.key,i]]"
                                           class="form-control"
                                           value="{{ exercise.sets }}" disabled>
                                    <input [hidden]="!hideWorkoutRowInputs[[note.key,i]]"
                                           #editRowSets
                                           value="{{ exercise.sets }}"
                                           class="form-control" autofocus>
                                </div>
                                <div class="align-middle col-4">
                                    <div class="border-bottom mt-1 mb-2 pb-1">Reps</div>
                                    <input [hidden]="hideWorkoutRowInputs[[note.key,i]]"
                                           class="form-control"
                                           value="{{ exercise.reps }}" disabled>
                                    <input [hidden]="!hideWorkoutRowInputs[[note.key,i]]"
                                           #editRowReps
                                           value="{{ exercise.reps }}"
                                           class="form-control">
                                </div>
                                <div class="align-middle col-4">
                                    <div class="border-bottom mt-1 mb-2 pb-1">Weight</div>
                                    <input [hidden]="hideWorkoutRowInputs[[note.key,i]]"
                                           class="form-control"
                                           value="{{ exercise.weight }}" disabled>
                                    <input [hidden]="!hideWorkoutRowInputs[[note.key,i]]"
                                           #editRowWeight
                                           value="{{ exercise.weight }}"
                                           class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

<!-- New Workout Form -->
<ng-template #new_workout_modal let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Add New Workout</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <app-workout-note-form (closeEvent)="modal.dismiss()"></app-workout-note-form>
</ng-template>

